apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "financial-rag-agent.fullname" . }}-test-connection"
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "financial-rag-agent.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: test-connection
      image: busybox:1.35
      command: ['sh', '-c', 
        'echo "Testing connection to {{ include "financial-rag-agent.fullname" . }}:{{ .Values.app.service.port }}" &&
         wget --timeout=3 --tries=1 http://{{ include "financial-rag-agent.fullname" . }}:{{ .Values.app.service.port }}/health -q -O - | grep -q "healthy" && 
         echo "Health check passed" || echo "Health check failed"']
  restartPolicy: Never